{{ define "header" }}
{{ partialCached "transparent-header.html" . }}
{{ end }}

{{ define "main" }}
<style>
    footer {
        margin-top: 0;
    }
</style>
<span class="download-preview-page">
<div class="hero">
    <div class="hero-wrapper">
        <h1>{{ T "page.downloadPreview.header.titleText" }}</h1>

        <div class="hero-blurb">
            <p>{{ T "page.downloadPreview.header.subtitleText" | safeHTML }}</p>
        </div>
    </div>

    <div class="other-platforms">
        <div class="other-platforms-wrapper">
			{{ T "page.downloadPreview.header.lookingForOtherPlatformsText" (dict
				"linkOpen" "<a href='#stable'>"
				"linkClose" "</a>") | safeHTML
			}}
        </div>
    </div>
</div>

{{ $versions := where .Site.RegularPages "Type" "download/archive" }}

<div class="wrapper">
    <div class="padded" style="padding-top:0;margin-top:2rem">
        <h2>{{ T "page.downloadPreview.latestPreviewBuilds" }}</h2>

        <div class="preview-cards">
            {{ $stableVersions := where $versions "Params.flavor" "stable" }}
            {{ $stableVersionsNames := slice }}

            {{ range $version := $stableVersions }}
                {{ $stableVersionsNames = $stableVersionsNames | append $version.Params.name }}
            {{ end }}

            {{ $previewVersions := ((where $versions "Params.name" "not in" $stableVersionsNames).ByParam "Params.release_date").Reverse }}

            {{ range ($previewVersions.GroupByParam "name").Reverse }}
                {{ range .Pages | first 1 }}
                {{ partial "download/version-card.html" (dict "gCtx" $ "version" .Params ) }}
                {{ end }}
            {{ end }}
        </div>
    </div>
</div>

<div id="stable" class="wrapper card stable-download">
    <h2>{{ T "page.downloadPreview.needAStableVersion" }}</h2>

    <div class="stable-download-ready">
		<p> {{ T "page.features.readyToStart.downloadGodot4Text" | safeHTML }} </p>
		{{ partialCached "common/download-latest-button.html" . }}
		<p> {{ T "page.features.readyToStart.downloadGodot3Text" | safeHTML }} </p>
		{{ partialCached "common/download-lts-button.html" . }}
    </div>
</div>
</span>

{{ end }}
