{{ define "main" }}

{{ if .Params.youtube_id }}
<link rel="preload" href="https://www.youtube-nocookie.com/embed/{{ .Params.youtube_id }}" as="document" fetchpriority="high"/>
{{ end }}

<script>
    // Initialize lightbox.
    function initTobbi() {
        new Tobii({
            zoom: false,
        })
    }

    // Used for removing img background after loading, this is necessary to avoid edge color bleeding
    function removeFeatureImgBackground(el) {
        el.style.background = 'unset';
        el.style.backgroundColor = 'unset';
    }
</script>
{{ $tobiiJS := resources.Get "js/tobii.min.js" | resources.Fingerprint }}
<script defer src="{{ $tobiiJS.RelPermalink }}" integrity="{{ $tobiiJS.Data.Integrity }}" onload="initTobbi()"></script>

<style>
    .showcase-video-image {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1;
    }

    .showcase-video-image img {
        width: 100%;
        background:  linear-gradient(90deg, #947451 12%, #a8885f 29%, #8c8977 65%, #d2ba9f 98%)
    }

    .showcase-video-image img .youtube {
        border: 0;
        padding-bottom: 56.25%;
    }

    .showcase-developer-quote {
        font-style: italic;
        color: var(--base-color-text-title);
    }

    .showcase-developer-quote p:first-child::before {
        content: '“';
        font-size: 150%;
        margin-right: -0.1rem;
    }

    .showcase-developer-quote p:last-child::after {
        content: '”';
        font-size: 150%;
        margin-left: -0.1rem;
    }

    .showcase-intro-icons {
        filter: invert(100%);
        opacity: 0.75;
        margin-top: 1rem;
        display: flex;
        gap: 0.5rem;
    }

    .showcase-intro-icons img {
        width: 24px;
        height: 24px;
    }

    #info-buttons {
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 2rem;
        flex-direction: column;
        justify-content: center;
    }

    article h3 {
        margin-bottom: 0;
        margin-top: 30px;
    }

    #info-buttons a {
        white-space: nowrap;
    }
</style>

<div class="head">
    <div class="container flex eqsize responsive">
        <div class="main">

            <div style="margin: 1.25rem 0">
                <a href="/showcase"><strong>&lt;</strong>&nbsp;&nbsp;Back to showcase</a>
            </div>

            <h1 class="intro-title">{{ .Params.title }}</h1>
            <h3 style="opacity: 0.75; margin-top: 0.5rem">
                by <a href="{{ .Params.website }}" target="_blank"
                      style="text-decoration: underline; text-decoration-thickness: 0.125rem; text-decoration-color: hsla(0, 0%, 100%, 0.5)">{{
                .Params.author }}</a>
                | {{ if eq .Params.release_date "TBD" }}Release date: <abbr title="To Be Determined">TBD</abbr>{{ else }}{{
                .Params.release_date }}{{ end }}
            </h3>
            <div class="showcase-intro-icons">
                {{ if .Params.windows }}
                <img src="/assets/images/platforms/windows.svg" alt="Windows" title="Windows" width="24" height="24">
                {{ end }}

                {{ if .Params.macos }}
                <img src="/assets/images/platforms/macos.svg" alt="Mac" title="Mac" width="24" height="24">
                {{ end }}

                {{ if .Params.linux }}
                <img src="/assets/images/platforms/linux.svg" alt="Linux" title="Linux" width="24" height="24">
                {{ end }}

                {{ if .Params.switch }}
                <img src="/assets/images/platforms/switch.svg" alt="Nintendo Switch" title="Switch" width="24" height="24">
                {{ end }}

                {{ if .Params.html5 }}
                <img src="/assets/images/platforms/web.svg" alt="HTML5" title="HTML5" width="24" height="24">
                {{ end }}

                {{ if .Params.android }}
                <img src="/assets/images/platforms/android.svg" alt="Android" title="Android" height="24">
                {{ end }}

                {{ if .Params.ios }}
                <img src="/assets/images/platforms/ios.svg" alt="iOS" title="iOS" width="24" height="24">
                {{ end }}

                {{ if .Params.playstation }}
                <img src="/assets/images/platforms/playstation.svg" alt="PlayStation" title="PlayStation" width="24" height="24">
                {{ end }}

                {{ if .Params.xbox }}
                <img src="/assets/images/platforms/xbox.svg" alt="Xbox" title="Xbox"width="24" height="24">
                {{ end }}

            </div>

        </div>
    </div>
</div>

<div class="container">
    <section class="flex responsive" style="gap: 1rem;">
        <article style="flex: 1">
            {{ .Content }}

            <div id="info-buttons" class="flex responsive">
                {{ if .Params.steam }}
                <a href="{{ .Params.steam }}" class="btn" target="_blank">
                    View on Steam
                </a>
                {{ end }}

                {{ if .Params.itch }}
                <a href="{{ .Params.itch }}" class="btn" target="_blank">
                    View on itch.io
                </a>
                {{ end }}

                {{ if .Params.humble }}
                <a href="{{ .Params.humble }}" class="btn" target="_blank">
                    View on Humble Store
                </a>
                {{ end }}

                {{ if .Params.gog }}
                <a href="{{ .Params.gog }}" class="btn" target="_blank">
                    View on GOG.com
                </a>
                {{ end }}

                {{ if .Params.nintendo }}
                <a href="{{ .Params.nintendo }}" class="btn" target="_blank">
                    View on Nintendo Switch
                </a>
                {{ end }}

                {{ if .Params.microsoft }}
                <a href="{{ .Params.microsoft }}" class="btn" target="_blank">
                    View on Xbox
                </a>
                {{ end }}

                {{ if .Params.sony }}
                <a href="{{ .Params.sony }}" class="btn" target="_blank">
                    View on PlayStation
                </a>
                {{ end }}

                {{ if .Params.github }}
                <a href="{{ .Params.github }}" class="btn" target="_blank">
                    View on GitHub
                </a>
                {{ end }}

                {{ if .Params.appstore }}
                <a href="{{ .Params.appstore }}" class="btn" target="_blank">
                    View on App Store
                </a>
                {{ end }}

                {{ if .Params.googleplay }}
                <a href="{{ .Params.googleplay }}" class="btn" target="_blank">
                    View on Google Play
                </a>
                {{ end }}

                {{ if .Params.custom }}
                <a href="{{ .Params.custom }}" class="btn" target="_blank">
                    Learn More
                </a>
                {{ end }}
            </div>
        </article >
        <article class="showcase-video-image">
            {{ if .Params.youtube_id }}
            <div class="card youtube">
                <iframe src="https://www.youtube-nocookie.com/embed/{{ .Params.youtube_id }}"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen="">
                </iframe>
            </div>
            {{ end }}

            {{ range $index, $image := .Params.gallery }}
            <a href="{{ $image }}" class="lightbox" data-group="showcase">
                <img class="rounded-lg" src="{{ $image }}" alt="Screenshot of {{ $.Params.title }} by {{ $.Params.author }}" width="16" height="9" {{ if le $index 3 }}loading="lazy"{{ end }} onload="removeFeatureImgBackground(this)">
            </a>
            {{ end }}
        </article>
    </section>
    {{ if .Params.developer_interview }}
    <section style="margin-top: 3rem">
        <h3>{{ .Params.developer_interview.title }}</h3>

        <blockquote class="showcase-developer-quote">
            {{ .Params.developer_interview.text }}
        </blockquote>

        {{ if .Params.developer_interview.url }}
        <a href="{{ .Params.developer_interview.url }}">{{ .Params.developer_interview.context }}</a>
        {{ else }}
        <p>{{ .Params.developer_interview.context }}</p>
        {{ end }}
    </section>
    {{ end }}
</div>

{{ partialCached "preload-async-css.html" (dict "href" (resources.Get "css/tobii.min.css" | resources.Fingerprint).RelPermalink) }}
{{ end }}
